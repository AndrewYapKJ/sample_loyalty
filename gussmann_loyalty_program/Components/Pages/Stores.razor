@page "/stores"
@using gussmann_loyalty_program.Services
@inject IJSRuntime JSRuntime
@inject NavigationManager Navigation
@inject ISimpleAuthService AuthService
@rendermode InteractiveServer

<PageTitle>Stores - Gussmann Loyalty Program</PageTitle>

@if (!isAuthenticated)
{
   <div class="d-flex justify-content-center align-items-center" style="height: 100vh;">
      <div class="text-center">
         <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
            <span class="visually-hidden">Loading...</span>
         </div>
         <div class="mt-3">
            <h5 class="text-muted">Loading...</h5>
         </div>
      </div>
   </div>
}
else
{
   <div class="container-fluid">
      <div class="row mb-4">
         <div class="col">
            <h1 class="display-5">
               <i class="bi bi-shop text-success me-3"></i>
               Store Management
            </h1>
            <p class="lead text-muted">Manage your store locations and settings</p>
         </div>
      </div>

      <div class="alert alert-info" role="alert">
         <i class="bi bi-info-circle me-2"></i>
         <strong>Coming Soon:</strong> Store management functionality is being developed.
      </div>

      <div class="text-center py-5">
         <i class="bi bi-shop text-muted" style="font-size: 4rem;"></i>
         <h3 class="mt-3 text-muted">Store Management</h3>
         <p class="text-muted">This feature will allow you to:</p>
         <ul class="list-unstyled text-muted">
            <li>• Add and manage store locations</li>
            <li>• Configure store settings</li>
            <li>• Track store performance</li>
            <li>• Manage store staff</li>
         </ul>
      </div>
   </div>
}

@code {
   private bool isAuthenticated = false;

   protected override async Task OnAfterRenderAsync(bool firstRender)
   {
      if (firstRender)
      {
         await CheckAuthentication();
         StateHasChanged();
      }
   }

   private async Task CheckAuthentication()
   {
      try
      {
         var token = await JSRuntime.InvokeAsync<string>("localStorage.getItem", "jwtToken");

         if (string.IsNullOrEmpty(token))
         {
            Navigation.NavigateTo("/", true);
            return;
         }

         isAuthenticated = await AuthService.ValidateTokenAsync(token);

         if (!isAuthenticated)
         {
            Navigation.NavigateTo("/", true);
         }
      }
      catch (Exception ex)
      {
         Console.WriteLine($"Authentication error: {ex.Message}");
         Navigation.NavigateTo("/", true);
      }
   }
}