
@inherits LayoutComponentBase
@using Radzen
@using Radzen.Blazor
@using Microsoft.JSInterop
@using Microsoft.Extensions.Logging
@inject IJSRuntime JSRuntime
@inject NavigationManager Navigation
@inject ILogger<MainLayout> Logger

<div class="layout-shell" style="min-height:100vh; display:flex; flex-direction:column;">
    <div class="topbar" style="background:#1e4a3b; color:#fff; height:56px; display:flex; align-items:center; padding:0 1rem;">
        <RadzenButton Icon="menu" Click="ToggleSidebar" Style="background:transparent; color:#fff; border:none; margin-right:1rem;" />
        <span class="app-title" style="font-weight:600; font-size:1.2rem;">Loyalty Admin</span>
        <div style="margin-left:auto; display:flex; gap:.5rem;">
            <RadzenButton Icon="brightness_6" Click="ToggleTheme" Style="background:transparent; color:#fff; border:none;" />
            <RadzenButton Icon="logout" Click="Logout" Style="background:transparent; color:#fff; border:none;" />
        </div>
    </div>
    <div style="flex:1; display:flex; min-height:calc(100vh - 56px);">
        <div class="sidebar-wrapper" style="width:@(sidebarExpanded ? "260px" : "70px"); transition:width .3s; overflow:hidden; background: linear-gradient(180deg,#1e4a3b 0%,#0f2419 100%); color:#fff;">
            <RadzenPanelMenu Style="background:transparent; color:white;" IconColor="white">
                <RadzenPanelMenuItem Text="Dashboard" Icon="home" Path="/dashboard" />
                <RadzenPanelMenuItem Text="Counter" Icon="calculate" Path="/counter" />
                <RadzenPanelMenuItem Text="Weather" Icon="cloud" Path="/weather" />
                <RadzenPanelMenuItem Text="Members" Icon="people" Path="/members" />
                <RadzenPanelMenuItem Text="Customers" Icon="person" Path="/customers" />
                <RadzenPanelMenuItem Text="Transactions" Icon="receipt" Path="/transactions" />
                <RadzenPanelMenuItem Text="Stores" Icon="store" Path="/stores" />
                <RadzenPanelMenuItem Text="Campaigns & Vouchers" Icon="campaign" Path="/campaigns" />
                <RadzenPanelMenuItem Text="Rewards" Icon="card_giftcard" Path="/rewards" />
                <RadzenPanelMenuItem Text="Loyalty Points" Icon="stars" Path="/loyalty-points" />
                <RadzenPanelMenuItem Text="Point Manager" Icon="settings" Path="/point-manager" />
                <RadzenPanelMenuItem Text="Loyalty Accounts" Icon="account_box" Path="/loyalty-accounts" />
                <RadzenPanelMenuItem Text="Appointments" Icon="event" Path="/appointments" />
            </RadzenPanelMenu>
        </div>
        <div class="layout-content" style="flex:1; padding:2rem; overflow:auto; background:#fff;">
            @Body
        </div>
    </div>
</div>

@code {
    private bool sidebarExpanded = true;
    private string currentTheme = "default";

    void ToggleSidebar()
    {
        sidebarExpanded = !sidebarExpanded;
        Logger.LogInformation("Sidebar toggled. Expanded: {Expanded}", sidebarExpanded);
        StateHasChanged();
    }

    async Task ToggleTheme()
    {
        currentTheme = currentTheme == "default" ? "dark" : "default";
        Logger.LogInformation("Theme toggle requested. New theme: {Theme}", currentTheme);
        await JSRuntime.InvokeVoidAsync("changeTheme", currentTheme);
    }

    async Task Logout()
    {
        Logger.LogInformation("Logout requested.");
        await JSRuntime.InvokeVoidAsync("localStorage.removeItem", "authToken");
        await JSRuntime.InvokeVoidAsync("localStorage.removeItem", "refreshToken");
        Navigation.NavigateTo("/", true);
    }
}